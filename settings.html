<div class="battle-settings-container" style="padding: 15px;">
    <h3 style="margin-top: 0;">🎮 AI策略对战配置</h3>

    <!-- 游戏模式选择 -->
    <div style="margin-bottom: 20px; padding: 15px; background: var(--black30a); border-radius: 8px; border-left: 4px solid #FF5722;">
        <h3 style="margin: 0 0 10px 0; color: #FF5722;">🎯 游戏模式</h3>
        <select id="game_mode" class="text_pole" style="width: 100%; font-size: 14px;">
            <option value="universal">通用模式（依赖世界书/酒馆AI）</option>
            <option value="werewolf">狼人杀模式（内置规则，无需世界书）</option>
        </select>
        <p style="font-size: 12px; color: #888; margin: 10px 0 0 0;">
            💡 <strong>通用模式</strong>：由酒馆AI（世界书）定义规则，GM根据规则主持<br>
            🐺 <strong>狼人杀模式</strong>：扩展内置完整狼人杀规则，自动管理游戏流程
        </p>
    </div>

    <!-- GM 系统提示词配置 -->
    <div id="universal_mode_settings">
    <div style="margin-bottom: 20px; padding: 15px; background: var(--black30a); border-radius: 8px; border-left: 4px solid #9C27B0;">
        <h3 style="margin: 0 0 10px 0; color: #9C27B0;">🎭 GM 系统提示词</h3>
        <p style="font-size: 12px; color: #888; margin-bottom: 10px;">
            这段提示词会在每次调用 GM 时自动附加，用于明确 GM 的身份和任务。
        </p>
        <textarea id="gm_system_prompt" class="text_pole" rows="6" style="width: 100%; resize: vertical;">你是一个游戏主持人（GM），负责协调多个AI玩家进行游戏。

你的职责：
1. 严格根据聊天记录中的游戏规则主持游戏
2. 使用【轮到：玩家名】来指定某个玩家公开行动
3. 使用【秘密指示：玩家名|内容】来给某个玩家发送秘密信息
4. 绝对不要偏离当前游戏主题，不要回答无关问题</textarea>
    </div>

    <!-- ⭐ 新增：GM API 配置 -->
    <div style="margin-bottom: 20px; padding: 15px; background: var(--black30a); border-radius: 8px; border-left: 4px solid #4CAF50;">
        <h3 style="margin: 0 0 10px 0; color: #4CAF50;">🤖 GM API 配置</h3>
        <div class="gm-config-section">
            <h3>🎙️ 解说员配置</h3>
            
            <label class="checkbox_label">
                <input type="checkbox" id="commentatorEnabled" />
                <span>启用AI解说员</span>
            </label>
            <small>使用GM的API配置生成游戏解说，增加观赏性</small>
            
            <label for="commentatorStyle">解说风格（选填）</label>
            <textarea 
                id="commentatorStyle" 
                rows="4" 
                class="text_pole"
                style="width: 100%;"
                placeholder="留空使用默认激情风格。或自定义：如'你是专业冷静的解说员...'"
            ></textarea>
        </div>
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
            <div style="flex: 1;">
                <label style="display: block; margin-bottom: 5px;">API 地址</label>
                <input id="gm_api_url" type="text" class="text_pole" style="width: 100%;" placeholder="https://api.openai.com/v1" />
            </div>
            <div style="flex: 1;">
                <label style="display: block; margin-bottom: 5px;">
                    模型
                    <button id="fetch_gm_models" class="menu_button" style="padding: 2px 8px; margin-left: 5px; font-size: 11px;">🔄 拉取</button>
                </label>
                <select id="gm_model" class="text_pole" style="width: 100%;">
                    <option value="gpt-4">gpt-4</option>
                </select>
            </div>
        </div>
        <div>
            <label style="display: block; margin-bottom: 5px;">API Key</label>
            <input id="gm_api_key" type="password" class="text_pole" style="width: 100%;" placeholder="sk-..." />
        </div>
    </div>
    
    <!-- 6个AI配置 -->
    <div class="players-config">
        <!-- 玩家 1 -->
        <div class="ai-player-config" style="margin-bottom: 20px; padding: 15px; background: var(--black30a); border-radius: 8px;">
            <h4 style="margin-top: 0; color: var(--SmartThemeQuoteColor);">👤 玩家 1</h4>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">游戏中的名称（GM会用这个名字称呼）</label>
                <input type="text" id="player1_name" placeholder="哈基米" class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">API URL</label>
                <input type="text" id="player1_api_url" placeholder="http://127.0.0.1:8888/v1" class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">API Key</label>
                <input type="password" id="player1_api_key" placeholder="sk-..." class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">模型</label>
                <input type="text" id="player1_model" placeholder="gemini-2.5-pro" class="text_pole" style="width: 100%;">
            </div>
            <details style="margin-top: 10px;">
                <summary style="cursor: pointer; color: var(--SmartThemeBodyColor); font-weight: bold;">⚙️ 高级：自定义人格提示词（可选）</summary>
                <textarea id="player1_custom_prompt" class="text_pole" placeholder="例如：你性格谨慎，不轻易相信他人，喜欢从逻辑角度分析问题..." style="width: 100%; height: 80px; margin-top: 10px; resize: vertical;"></textarea>
            </details>
        </div>
        
        <!-- 玩家 2 -->
        <div class="ai-player-config" style="margin-bottom: 20px; padding: 15px; background: var(--black30a); border-radius: 8px;">
            <h4 style="margin-top: 0; color: var(--SmartThemeQuoteColor);">👤 玩家 2</h4>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">游戏中的名称</label>
                <input type="text" id="player2_name" placeholder="克劳德4.1op" class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">API URL</label>
                <input type="text" id="player2_api_url" placeholder="https://api.openai.com/v1" class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">API Key</label>
                <input type="password" id="player2_api_key" placeholder="sk-..." class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">模型</label>
                <input type="text" id="player2_model" placeholder="claude-4.1-opus" class="text_pole" style="width: 100%;">
            </div>
            <details style="margin-top: 10px;">
                <summary style="cursor: pointer; color: var(--SmartThemeBodyColor); font-weight: bold;">⚙️ 高级：自定义人格提示词（可选）</summary>
                <textarea id="player2_custom_prompt" class="text_pole" placeholder="例如：你性格激进，喜欢主动出击，善于煽动情绪..." style="width: 100%; height: 80px; margin-top: 10px; resize: vertical;"></textarea>
            </details>
        </div>
        
        <!-- 玩家 3 -->
        <div class="ai-player-config" style="margin-bottom: 20px; padding: 15px; background: var(--black30a); border-radius: 8px;">
            <h4 style="margin-top: 0; color: var(--SmartThemeQuoteColor);">👤 玩家 3</h4>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">游戏中的名称</label>
                <input type="text" id="player3_name" placeholder="gpt4.1" class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">API URL</label>
                <input type="text" id="player3_api_url" placeholder="https://api.openai.com/v1" class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">API Key</label>
                <input type="password" id="player3_api_key" placeholder="sk-..." class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">模型</label>
                <input type="text" id="player3_model" placeholder="gpt-4" class="text_pole" style="width: 100%;">
            </div>
            <details style="margin-top: 10px;">
                <summary style="cursor: pointer; color: var(--SmartThemeBodyColor); font-weight: bold;">⚙️ 高级：自定义人格提示词（可选）</summary>
                <textarea id="player3_custom_prompt" class="text_pole" placeholder="例如：你是话痨型玩家，喜欢详细分析每个细节..." style="width: 100%; height: 80px; margin-top: 10px; resize: vertical;"></textarea>
            </details>
        </div>
        
        <!-- 玩家 4 -->
        <div class="ai-player-config" style="margin-bottom: 20px; padding: 15px; background: var(--black30a); border-radius: 8px;">
            <h4 style="margin-top: 0; color: var(--SmartThemeQuoteColor);">👤 玩家 4</h4>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">游戏中的名称</label>
                <input type="text" id="player4_name" placeholder="GLM4.6" class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">API URL</label>
                <input type="text" id="player4_api_url" placeholder="https://api.openai.com/v1" class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">API Key</label>
                <input type="password" id="player4_api_key" placeholder="sk-..." class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">模型</label>
                <input type="text" id="player4_model" placeholder="GLM-4" class="text_pole" style="width: 100%;">
            </div>
            <details style="margin-top: 10px;">
                <summary style="cursor: pointer; color: var(--SmartThemeBodyColor); font-weight: bold;">⚙️ 高级：自定义人格提示词（可选）</summary>
                <textarea id="player4_custom_prompt" class="text_pole" placeholder="例如：你是沉默寡言型，只在关键时刻发言..." style="width: 100%; height: 80px; margin-top: 10px; resize: vertical;"></textarea>
            </details>
        </div>
        
        <!-- 玩家 5 -->
        <div class="ai-player-config" style="margin-bottom: 20px; padding: 15px; background: var(--black30a); border-radius: 8px;">
            <h4 style="margin-top: 0; color: var(--SmartThemeQuoteColor);">👤 玩家 5</h4>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">游戏中的名称</label>
                <input type="text" id="player5_name" placeholder="deepseek" class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">API URL</label>
                <input type="text" id="player5_api_url" placeholder="https://api.openai.com/v1" class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">API Key</label>
                <input type="password" id="player5_api_key" placeholder="sk-..." class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">模型</label>
                <input type="text" id="player5_model" placeholder="deepseek-chat" class="text_pole" style="width: 100%;">
            </div>
            <details style="margin-top: 10px;">
                <summary style="cursor: pointer; color: var(--SmartThemeBodyColor); font-weight: bold;">⚙️ 高级：自定义人格提示词（可选）</summary>
                <textarea id="player5_custom_prompt" class="text_pole" placeholder="例如：你是随和型玩家，容易被说服..." style="width: 100%; height: 80px; margin-top: 10px; resize: vertical;"></textarea>
            </details>
        </div>
        
        <!-- 玩家 6 -->
        <div class="ai-player-config" style="margin-bottom: 20px; padding: 15px; background: var(--black30a); border-radius: 8px;">
            <h4 style="margin-top: 0; color: var(--SmartThemeQuoteColor);">👤 玩家 6</h4>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">游戏中的名称</label>
                <input type="text" id="player6_name" placeholder="MINi" class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">API URL</label>
                <input type="text" id="player6_api_url" placeholder="https://api.openai.com/v1" class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">API Key</label>
                <input type="password" id="player6_api_key" placeholder="sk-..." class="text_pole" style="width: 100%;">
            </div>
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">模型</label>
                <input type="text" id="player6_model" placeholder="minimax" class="text_pole" style="width: 100%;">
            </div>
            <details style="margin-top: 10px;">
                <summary style="cursor: pointer; color: var(--SmartThemeBodyColor); font-weight: bold;">⚙️ 高级：自定义人格提示词（可选）</summary>
                <textarea id="player6_custom_prompt" class="text_pole" placeholder="例如：你是理性分析型，擅长通过投票模式找出狼人..." style="width: 100%; height: 80px; margin-top: 10px; resize: vertical;"></textarea>
            </details>
        </div>
    </div>
    </div>
    
    <button id="save_battle_settings" class="menu_button" style="width: 100%; padding: 12px; font-size: 16px; margin-top: 10px;">💾 保存配置</button>
    
    <div style="margin-top: 20px; padding: 15px; background: var(--black50a); border-radius: 8px;">
        <h4 style="margin-top: 0;">📖 使用说明</h4>
        <ol style="margin: 0; padding-left: 20px; line-height: 1.8;">
            <li><strong>配置6个AI</strong>：填写名称（游戏中显示的名字）、API信息</li>
            <li><strong>在酒馆对话中触发规则</strong>：输入"开始狼人杀游戏"，世界书会被触发，酒馆AI会回复完整规则</li>
            <li><strong>点击"开始游戏"</strong>：右侧浮动面板的"开始游戏"按钮</li>
            <li><strong>GM主持游戏</strong>：酒馆AI会根据规则发出指令：
                <ul style="margin-top: 5px;">
                    <li><code>【轮到：哈基米】</code> - 让哈基米公开发言</li>
                    <li><code>【秘密指示：哈基米|你是狼人】</code> - 给哈基米秘密信息（不会出现在聊天中）</li>
                </ul>
            </li>
            <li><strong>采访AI</strong>：游戏中可随时采访任意AI，查看其秘密信息和想法</li>
            <li><strong>继续游戏</strong>：每轮后点击"继续游戏"推进</li>
            <li><strong>游戏结束</strong>：GM说"游戏结束"时自动停止</li>
        </ol>
        
        <h4 style="margin-top: 15px;">🔒 秘密信息机制</h4>
        <p style="margin: 5px 0; line-height: 1.6;">
            当GM发送<code>【秘密指示：玩家名|秘密内容】</code>时，扩展会：<br>
            1️⃣ 将秘密内容存储到该AI的私密记忆中<br>
            2️⃣ 下次轮到该AI行动时，秘密信息通过<strong>直接API调用</strong>发送给AI<br>
            3️⃣ 其他AI和聊天记录中<strong>看不到</strong>这些秘密信息<br>
            4️⃣ 你可以通过"采访AI"功能查看任意AI的秘密信息
        </p>
    </div>
</div>
