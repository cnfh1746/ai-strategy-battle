# 🎮 AI策略对战扩展

一个创新的SillyTavern扩展，让多个AI在游戏规则下进行策略对抗和智斗。目前支持**狼人杀**游戏模式。

## ✨ 核心特性

### 🤖 多AI对战系统
- 支持配置6个独立AI玩家
- 每个AI拥有独立的API配置和模型选择
- 可为每个AI定制独特的人格特征
- AI之间的秘密信息完全隔离

### 🎭 完整的狼人杀游戏
- **自动角色分配**：狼人×2、村民×2、预言家×1、女巫×1
- **夜晚阶段**：狼人攻击、预言家查验、女巫救人
- **白天阶段**：AI轮流发言、投票驱逐
- **智能推理**：AI根据秘密情报和公开信息进行推理
- **动态Prompt**：每个AI收到的指令基于其身份和知识定制

### ⏸️ 暂停与采访系统
- 游戏在每个阶段自动暂停
- 用户可在暂停时**采访任何AI**
- AI会根据其角色和秘密情报回答问题
- 了解AI的真实想法和推理过程

### 📝 实时提示词监控
- 浮动控制台实时显示所有发给AI的提示词
- 查看AI收到的具体指令
- 监控AI的完整回复
- 帮助理解AI决策过程

### 🎨 独立浮动UI
- 不占用扩展设置空间
- 浮动在聊天界面右侧
- 可折叠/展开
- 美观且易用

## 📦 安装

1. 将整个 `ai-strategy-battle` 文件夹放入：
   ```
   SillyTavern/public/scripts/extensions/third-party/
   ```

2. 重启SillyTavern

3. 在扩展设置中找到"🎮 AI策略对战"

## 🚀 快速开始

### 第一步：配置AI玩家

1. 打开扩展设置
2. 为6个AI配置：
   - **名称**：如 AI-Alpha, AI-Beta...
   - **API Key**：OpenAI API密钥
   - **模型**：如 gpt-4, gpt-3.5-turbo
   - **自定义人格**（可选）：
     ```
     例如：你性格谨慎，不轻易相信他人，喜欢从逻辑角度分析问题
     ```

### 第二步：创建世界书规则

1. 在SillyTavern中创建新世界书
2. 添加条目，关键词包含"狼人杀"
3. 在内容中写入游戏规则：
   ```
   狼人杀游戏规则：
   - 角色：狼人、村民、预言家、女巫
   - 狼人目标：杀光所有好人
   - 好人目标：找出并驱逐所有狼人
   - 夜晚：狼人攻击、预言家查验、女巫救人
   - 白天：所有人发言、投票驱逐
   - 胜利条件：狼人全灭或狼人≥好人
   ```

4. 在扩展设置中填入世界书名称

### 第三步：开始游戏

1. 保存配置
2. 在聊天界面右侧出现"AI对战控制台"
3. 点击 **▶️ 开始游戏**
4. 游戏自动运行，在每个阶段暂停

### 第四步：观察与采访

- **观察**：查看AI在聊天中的发言和投票
- **查看Prompt**：在控制台展开"实时提示词记录"
- **采访AI**：
  1. 选择要采访的AI
  2. 输入问题（如"你觉得谁是狼人？"）
  3. AI根据其身份和情报回答
- **继续游戏**：点击 **⏭️ 继续游戏**

## 🎯 游戏流程

```
开始游戏
  ↓
【第1夜】
  ├─ 狼人选择攻击目标
  ├─ 预言家查验玩家
  └─ 女巫决定是否救人
  ↓
⏸️ 暂停 - 用户可采访AI
  ↓
【第1天】
  ├─ 宣布死亡结果
  ├─ 所有AI轮流发言
  └─ 所有AI投票驱逐
  ↓
⏸️ 暂停 - 用户可采访AI
  ↓
检查胜利条件 → 继续下一夜或游戏结束
```

## 🔧 技术架构

### 核心模块

1. **GameEngine（引擎层）**
   - API通信
   - 秘密信息隔离
   - 世界书规则读取

2. **GameStateManager（状态管理）**
   - 游戏状态存储
   - 角色分配
   - 胜利条件判断

3. **ActionParser（指令解析）**
   - 正则表达式解析AI回复
   - 容错机制和重试逻辑
   - 格式化提示

4. **WerewolfGame（游戏逻辑）**
   - 异步游戏循环
   - 夜晚/白天阶段执行
   - 动态Prompt生成
   - 暂停/恢复机制

### Prompt设计原理

每个AI收到的Prompt包含：

```javascript
[人格设定]（如果配置了）
你性格谨慎，不轻易相信他人...

[公开上下文]
游戏历史对话...

[系统秘密指令 - 其他玩家看不到]
你的身份：狼人
你的狼人队友：AI-Beta
存活玩家：AI-Alpha、AI-Beta、AI-Gamma...
你的秘密情报：AI-Delta是好人

现在是夜晚，请选择攻击目标。
可选目标：AI-Gamma、AI-Delta、AI-Echo
请用格式回复：[行动：攻击XXX]
```

## 🎨 自定义人格示例

```javascript
// 谨慎型
你性格谨慎，不轻易相信他人，喜欢从逻辑角度分析问题。你会仔细观察每个人的发言，寻找矛盾之处。

// 激进型
你性格激进，喜欢主动出击，善于煽动情绪。你会大胆指控可疑对象，引导投票方向。

// 话痨型
你是话痨型玩家，喜欢详细分析每个细节。你的发言通常很长，会回顾历史信息并提出多个推理。

// 沉默型
你是沉默寡言型，只在关键时刻发言。你通常用简短的话表达立场，不会透露太多信息。

// 随和型
你是随和型玩家，容易被说服。你倾向于相信发言有理有据的人，会根据他人意见调整判断。

// 理性分析型
你是理性分析型，擅长通过投票模式找出狼人。你会记录每个人的投票记录，从中寻找规律。
```

## 🔮 未来扩展

- [ ] 支持更多游戏模式（三国杀、阿瓦隆等）
- [ ] 自定义角色配置
- [ ] 游戏回放系统
- [ ] AI行为数据分析
- [ ] 多轮游戏统计

## 🐛 故障排除

### AI没有按格式回复
- 检查模型是否支持复杂指令（建议使用gpt-4）
- 适当调整人格提示词长度

### API调用失败
- 确认API Key正确
- 检查API额度
- 查看浏览器控制台错误信息

### 游戏卡住
- 点击"停止游戏"重新开始
- 检查网络连接

## 📄 许可证

MIT License

## 👨‍💻 作者

AI Strategy Battle Extension

---

**享受AI之间的智慧对决吧！🎮**
